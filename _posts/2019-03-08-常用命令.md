# 常用命令

<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [常用命令](#常用命令)
- [功能](#功能)
	- [通配符](#通配符)
	- [重定向](#重定向)
	- [管道](#管道)
	- [组合命令](#组合命令)
	- [历史命令](#历史命令)
- [文本处理](#文本处理)
	- [查看文本 （cat,less,more,vi,od）](#查看文本-catlessmoreviod)
	- [grep](#grep)
	- [awk](#awk)
- [文件操作](#文件操作)
	- [文件信息 file stat](#文件信息-file-stat)
	- [远程文件拷贝 scp sftp](#远程文件拷贝-scp-sftp)
	- [查找文件 locate find](#查找文件-locate-find)
	- [压缩文件 tar](#压缩文件-tar)
	- [符号链接 ln](#符号链接-ln)
	- [文件比较 diff](#文件比较-diff)
- [工具](#工具)
	- [watch](#watch)
	- [screen](#screen)
	- [tcpdump](#tcpdump)
- [系统信息](#系统信息)
- [进程](#进程)
	- [ps](#ps)
	- [进程详细信息 （/proc/pid/）](#进程详细信息-procpid)
	- [top](#top)
	- [lsof 打开的文件](#lsof-打开的文件)
- [网络](#网络)
	- [Traceroute ip](#traceroute-ip)
	- [route](#route)
	- [nslook](#nslook)
- [帮助](#帮助)
	- [man](#man)
	- [系统日志](#系统日志)
	- [更多](#更多)

<!-- /TOC -->

# 功能

linux的设计理念，就是用shell命令来完成很多复制的工作。 shell包含特色功能。
## 通配符
包括 `*`，花括号展开，引号等高级用法。
`echo ~` echo可以用来看通配符的展开情况

## 重定向
`> 重定位到文件 >> 是追加内容`
`ls -l /bin/usr > ls-output.txt 2>&1` `2>&1`是重定位标准错误输出
`> /dev/null` 重定向到null，相当于忽略输出
## 管道
可以对文本做多个复杂的处理
`cat .bash_history |sort|uniq -c|sort -rn|head` 看历史命令使用最多的前几条（uniq前必须先排序）
## 组合命令
`command1,command2`
## 历史命令
ctrl+r 搜索历史命令

# 文本处理
## 查看文本 （cat,less,more,vi,od）
`cat`,`less`,`more`,`vi`,`od` 都可以对文件进行查看。
- `cat -n`输出带行号
- `less` view file 代替more，可以前后翻页
- `od -x` 或则 `hexdump` 以16进制的方式查看文件

## grep
**常用选项**

选项|描述  
--|--
-n| 匹配结果的时候，给出行号
-C10|输出匹配行号，并输出上下n行 `grep -C10 pattern filename`
-r  |  查找文件夹 `grep -r xx ./`
-E  |  使用扩展正则，可以同时匹配多个表达式 `grep -E 'pattern1\&#124;pattern2' filename`
-i  |  忽略大小写

## awk
按照给定分隔符，一般是空格，将文本当做表格处理。在需要对查找出来的问题，做高级统计的时候需要用到
- `grep '过期' logs/message.log |awk '{sum+=substr($8,7)} END {print sum}'|more`



# 文件操作
## 文件信息 file stat
- file 查看文件的类型
- stat 文件修改时间

## 远程文件拷贝 scp sftp
scp 和 sftp 可以通过ssh在服务器之间传输文件。
- `scp -p22 root@192.168.2.207:~/fixAgent.jar fixAgent.jar` 通过ssh复制文件
- `sftp root@192.168.2.207`

## 查找文件 locate find
快速的查找。locate 查询路径数据库
find 更复杂的
`find ~ -type d` 只搜索目录
`find ~ -type f -name "\*.JPG" -size +1M`
`find / -name "system.map"`
## 压缩文件 tar
- `tar -xvf archive_name.tar.gz` 解压文件
- `tar -cvf 1.ar *` 压缩文件

## 符号链接 ln
`ln -s file link` -s 软连接，可以是目录
## 文件比较 diff
`diff file1 file2` 比较文件的差异
`diff <(printenv) <(env)` 对于标准输出，可以直接进程替换比较

# 工具
`wc`统计行数或则字数
`md5sum file` 文件的md5码
`df` `free`

## watch
周期的执行给定命令。
`watch -n1 "netstat -ano|grep 10001 -c"`  不加n就默认两秒执行一次。

## screen
`screen -rd name` 重新连接一个会话

## tcpdump
抓包
tcpdump -i eth0 -nn port 9001
tcpdump -i eth0 -s 0 -w SuccessC2Server.pcap port 10001


# 系统信息

- 硬盘s使用情况 `df -h`  `-h`单位是g
- cpu信息 `lscpu` cpu信息概况，能看出是否虚拟化 `cat /proc/cpuinfo` 更详细的cpu信息
- 内存使用信息 `free -m`
- 查看定时任务列表 `crontab -l`
- 全部环境变量 `printenv` or `env`
- 输出单个环境变量 `echo $HOME`
- 系统启动时间 `who -b` `uptime`
- 活动用户 `who`
- 计算机名 `hostname`
- 查看用户登录日志 `last`
- 设置时间 `date -s 02/11/2012`
- 重启 `reboot`
- 切换用户 `su near` `su -`切换到超级用户
- CentOS版本 `cat /etc/redhat-release`   "CentOS Linux release 7.2.1511 (Core)"



# 进程

## ps



- `ps aux` x显示全部进程，au能显示更多的信息。TIME 字段表示进程所消耗的 CPU 时间数量。
```Cmd
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0 190716  3252 ?        Ss    2018   5:06 /usr/lib/systemd/systemd --system --deserialize 17
root         2  0.0  0.0      0     0 ?        S     2018   0:17 [kthreadd]
root         3  0.0  0.0      0     0 ?        S     2018   1:39 [ksoftirqd/0]
```
- `-o`可以指定额外的列显示得到更详细的进程信息。`ps -eo pid,lstart,etime|grep 17862` `ps -p 15202 -o etime=`  etime为执行了多久，格式是`[[DD-]hh:]mm:ss`。lstart是开始执行时间。
```Cmd
PID                  STARTED     ELAPSED
10899 Fri Mar 15 12:28:07 2019    02:29:39
15372 Thu Feb 28 12:42:51 2019 15-02:14:55
......
```


## 进程详细信息 （/proc/pid/）
这里包含进程相关的很多信息
- `ll /prod/pid` 可以看到很多信息,进程的工作目录和执行的命令等。
```Cmd
lrwxrwxrwx  1 root root 0 Mar 15 12:33 cwd -> /home/brgzadmin/online/server
-r--------  1 root root 0 Mar 15 12:33 environ
lrwxrwxrwx  1 root root 0 Mar 14 15:05 exe -> /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.141-1.b16.el7_3.x86_64/jre/bin/java
```
- `cat /rpoc/pid/maps` 进程的内存布局
```Cmd
00601000-00602000 rw-p 00001000 fd:01 134498201                          /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.141-1.b16.el7_3.x86_64/jre/bin/java
00ee6000-00f07000 rw-p 00000000 00:00 0                                  [heap]
85a00000-a6e80000 rw-p 00000000 00:00 0
......
```
- `ll fd` 进程打开的句柄。如果持有一个输出文件。就算被删除，也能找回来。
```Cmd
lr-x------ 1 root root 64 Mar 15 12:37 0 -> /dev/null
l-wx------ 1 root root 64 Mar 15 12:37 1 -> /home/brgzadmin/online/server/out.txt
lr-x------ 1 root root 64 Mar 15 12:37 10 -> /home/brgzadmin/online/server/lib/serial-client.jar
lr-x------ 1 root root 64 Mar 15 12:37 100 -> pipe:[30756313]
```

## top
`top -d 30 -p $pid -b` 统计指定进程的cpu占用。-b 可以作为输出，一直记录

## lsof 打开的文件

查看当前进程打开了多少句柄数	lsof -n|awk '{print $2}'|sort|uniq -c|sort -nr|more

# 网络
## Traceroute ip
查看经过的路由器，如果中间的路由器不支持返回信息，就会显示***
```Cmd
traceroute: Warning: www.baidu.com has multiple addresses; using 61.135.169.125
traceroute to www.a.shifen.com (61.135.169.125), 64 hops max, 52 byte packets
 1  192.168.200.1 (192.168.200.1)  6.941 ms  5.138 ms  4.306 ms
 2  * * *
```

## route
用于查看那系统的路由表信息
## nslook
nslook www.baidu.com
通过域名 查ip




---

# 帮助
## man
`man -k` 在man手册中搜索

section  | 内容  
--|--
1|用户命令
2|程序接口内核系统调用
3|C 库函数程序接口
4|特殊文件，比如说设备结点和驱动程序
5|文件格式
6|游戏娱乐，如屏幕保护程序
7|其他方面
8|系统管理员命令

## 系统日志
- dmesg -T 内核日志
- /var/log/message 系统启动后的信息和错误日志，是Red Hat Linux中最常用的日志之一

## 更多
关于系统方面的命令，在[《性能调优》](2019-03-12-性能调优)有更多的分析。

Linux命令总结
http://linuxtools-rst.readthedocs.org/zh_CN/latest/index.html
